(function(b){function h(a,c,e){c&&e?e.container=c:e=b.isPlainObject(c)?c:{container:c};e.container&&(e.container=l(e.container));c=a.currentTarget;if("A"!==c.tagName.toUpperCase())throw"$.fn.pjax or $.pjax.click requires an anchor element";if(!(1<a.which||a.metaKey))if(!(location.protocol!==c.protocol||location.host!==c.host)&&!(c.hash&&c.href.replace(c.hash,"")===location.href.replace(location.hash,"")))return c={url:c.href,container:b(c).attr("data-pjax"),target:c,clickedElement:b(c),fragment:null},
b.pjax(b.extend({},c,e)),a.preventDefault(),!1}function s(a){var c=document.createElement("a");c.href=a;return c}function l(a){a=b(a);if(a.length){if(""!==a.selector&&a.context===document)return a;if(a.attr("id"))return b("#"+a.attr("id"));throw"cant get selector for pjax container!";}throw"no pjax container for "+a.selector;}function m(a,c){var e=b();a.each(function(){b(this).is(c)&&(e=e.add(this));e=e.add(c,this)});return e}function n(a,c,e){var d={},c=(c.getResponseHeader("X-PJAX-URL")||e.url).replace(/\?_pjax=[^&]+&?/,
"?").replace(/_pjax=[^&]+&?/,"").replace(/[\?&]$/,"");d.url=c;c=b(a);if(0===c.length)return d;d.title=m(c,"title").last().text();e.fragment?(a=m(c,e.fragment).first(),a.length&&(d.contents=a.contents(),d.title||(d.title=a.attr("title")||a.data("title")))):/<html/i.test(a)||(d.contents=c);d.contents&&(d.contents=d.contents.not("title"),d.contents.find("title").remove());d.title&&(d.title=b.trim(d.title));return d}b.fn.pjax=function(a,c){return this.live("click.pjax",function(b){return h(b,a,c)})};
var f=b.pjax=function(a){function c(a,c){var d=b.Event(a,{relatedTarget:e});i.trigger(d,c);return!d.isDefaultPrevented()}a=b.extend(!0,{},b.ajaxSettings,f.defaults,a);b.isFunction(a.url)&&(a.url=a.url());var e=a.target;!e&&a.clickedElement&&(e=a.clickedElement[0]);var d=s(a.url).hash,o=a.beforeSend,p=a.complete,q=a.success,h=a.error,i=a.context=l(a.container);a.data||(a.data={});a.data._pjax=i.selector;var k;a.beforeSend=function(b,d){if(d.timeout>0){k=setTimeout(function(){c("pjax:timeout",[b,a])&&
b.abort("timeout")},d.timeout);d.timeout=0}b.setRequestHeader("X-PJAX","true");b.setRequestHeader("X-PJAX-Container",i.selector);var e;if(o){e=o.apply(this,arguments);if(e===false)return false}if(!c("pjax:beforeSend",[b,d]))return false;c("pjax:start",[b,a]);c("start.pjax",[b,a])};a.complete=function(b,d){k&&clearTimeout(k);p&&p.apply(this,arguments);c("pjax:complete",[b,d,a]);c("pjax:end",[b,a]);c("end.pjax",[b,a])};a.error=function(b,d,e){var f=n("",b,a);h&&h.apply(this,arguments);var i=c("pjax:error",
[b,d,e,a]);if(d!=="abort"&&i)window.location=f.url};a.success=function(b,e,h){var g=n(b,h,a);if(g.contents){f.state={id:a.id||(new Date).getTime(),url:g.url,container:i.selector,fragment:a.fragment,timeout:a.timeout};if(g.title)document.title=g.title;i.html(g.contents);a.replace?window.history.replaceState(f.state,g.title,g.url):a.push&&window.history.pushState(f.state,g.title,g.url);(a.replace||a.push)&&window._gaq&&_gaq.push(["_trackPageview"]);if(d!=="")window.location.href=d;q&&q.apply(this,arguments);
c("pjax:success",[b,e,h,a])}else window.location=g.url};f.state||(f.state={id:(new Date).getTime(),url:window.location.href,container:i.selector,fragment:a.fragment,timeout:a.timeout},window.history.replaceState(f.state,document.title));var j=f.xhr;j&&4>j.readyState&&(j.onreadystatechange=b.noop,j.abort());f.options=a;f.xhr=b.ajax(a);b(document).trigger("pjax",[f.xhr,a]);return f.xhr};f.defaults={timeout:650,push:!0,replace:!1,type:"GET",dataType:"html"};f.click=h;var r="state"in window.history,t=
location.href;b(window).bind("popstate",function(a){var c=!r&&location.href==t;r=!0;if(!c&&(a=a.state)&&a.container)c=b(a.container),c.length?b.pjax({id:a.id,url:a.url,container:c,push:!1,fragment:a.fragment,timeout:a.timeout}):window.location=location.href});0>b.inArray("state",b.event.props)&&b.event.props.push("state");b.support.pjax=window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]|WebApps\/.+CFNetwork)/);b.support.pjax||
(b.pjax=function(a){var c=b.isFunction(a.url)?a.url():a.url,e=a.type?a.type.toUpperCase():"GET",d=b("<form>",{method:"GET"===e?"GET":"POST",action:c,style:"display:none"});"GET"!==e&&"POST"!==e&&d.append(b("<input>",{type:"hidden",name:"_method",value:e.toLowerCase()}));a=a.data;if("string"===typeof a)b.each(a.split("&"),function(a,c){var e=c.split("=");d.append(b("<input>",{type:"hidden",name:e[0],value:e[1]}))});else if("object"===typeof a)for(key in a)d.append(b("<input>",{type:"hidden",name:key,
value:a[key]}));b(document.body).append(d);d.submit()},b.pjax.click=b.noop,b.fn.pjax=function(){return this})})(jQuery);
